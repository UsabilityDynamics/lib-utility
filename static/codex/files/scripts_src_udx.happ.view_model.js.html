<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scripts/src/udx.happ.view_model.js - usabilitydynamics/lib-utility</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="usabilitydynamics/lib-utility"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/event.html">event</a></li>
            
                <li><a href="../modules/ud.html">ud</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scripts/src/udx.happ.view_model.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * View Model
 *
 * @required jQuery, knockout, knockout.mapping, knockout.ud
 * @author peshkov@UD
 */

Application.define( &#x27;core.view_model&#x27;, function( args ) {

  /* Set arguments */
  args = jQuery.extend( true, {
    &#x27;_required&#x27;: {},
    &#x27;scope&#x27;: false, // Application&#x27;s object
    &#x27;model&#x27;: {}, //
    &#x27;view&#x27;: false, // HTML data or template&#x27;s url
    &#x27;container&#x27;: false, // HTML container
    &#x27;args&#x27;: {
      // Localization strings
      &#x27;l10n&#x27;: {
        &#x27;remove_confirmation&#x27;: &#x27;Are you sure you want to remove it?&#x27;
      }
    },
    // Set of actions listeners which are fired on view model &#x27;triggers&#x27;
    &#x27;actions&#x27;: {
      // Called on view_model update. view_model is updated on every selection ( see app.js -&gt; Sammy implementation )
      &#x27;update&#x27;: function() {
        return null;
      },
      // Called before ko.applyBindings() function
      &#x27;pre_apply&#x27;: function( self, callback ) {
        callback( null, true );
      },
      // Child Constructor. Called after ko.applyBindings() function
      &#x27;init&#x27;: function( self, callback ) {
        callback( null, true );
      },
      // Called after data adding
      &#x27;add_data&#x27;: function() {
        return null;
      },
      // Called after data removing
      &#x27;remove_data&#x27;: function() {
        return null;
      },
      // Additional callback
      &#x27;callback&#x27;: false
    },
    // Callback should not be overwritten! If you want to add your callback use actions.callback
    &#x27;callback&#x27;: function( error, data ) {
      var self = this;
      if( typeof self.actions === &#x27;object&#x27; &amp;&amp; typeof self.actions.callback === &#x27;function&#x27; ) {
        return self.actions.callback( error, data );
      } else {

        if( error &amp;&amp; error instanceof Error ) {
          console.error( error.message, data );
        }

        return data;

      }
    }
  }, typeof args === &#x27;object&#x27; ? args : {} );

  /* Check container argument */
  var container = ( args.container &amp;&amp; typeof args.container !== &#x27;object&#x27; ) ? jQuery( args.container ) : args.container;

  if( !container || typeof container.length === &#x27;undefined&#x27; || !container.length &gt; 0 ) {
    return args.callback( new Error( &#x27;ko.view_model. Container is missing, or incorrect.&#x27; ), false );
  }

  /* Appends View if it exists */
  if( args.view ) {

    /* Determine if view is link we try to get template using ajax. */
    if( /^((https?|ftp):)?\/\/([\-A-Z0-9.]+)(\/[\-A-Z0-9+&amp;@#\/%=~_|!:,.;]*)?(\?[A-Z0-9+&amp;@#\/%=~_|!:,.;]*)?/i.test( args.view ) ) {
      jQuery.ajax( {
        url: args.view,
        async: false,
        dataType: &#x27;html&#x27;,
        complete: function( r, status ) {
          args.view = r.responseText;
        }
      } );
    }
    container.html( args.view );
  }

  var html = container.html();

  container.html( &#x27;&#x27; ).addClass( &#x27;ud_view_model ud_ui_loading&#x27; ).append( &#x27;&lt;div class=&quot;ud_ui_spinner&quot;&gt;&lt;/div&gt;&#x27; ).append( &#x27;&lt;div class=&quot;ud_ui_prepared_interface&quot;&gt;&lt;/div&gt;&#x27; ).find( &#x27;.ud_ui_prepared_interface&#x27; ).html( html );

  /**
   * Creates View_Model
   */
  var vm = function( args, container ) {

    var self = this;

    /* Determines if view_model already applied Bindings ( ko.applyBinding )  */
    self._applied = false;

    /* Arguments */
    self._args = args;

    /* Application&#x27;s object */
    self.scope = args.scope;

    /* Application core functions */
    self.core = args.scope.core;

    /* Socket connection */
    self.socket = typeof args.scope.socket === &#x27;object&#x27; ? args.scope.socket : false;

    /* DOM */
    self.container = container;

    /**
     * Pushes new element to array.
     *
     * Example of usage:
     * data-bind=&quot;click: $root.add_data.bind( $data, $root.some_array, $root.vhandler )&quot;
     * where $root.vhandler is a function, which creates data.
     *
     * $root.vhandler example:
     * self.handler = function() {
     *   var self = this;
     *   self.arg1 = ko.observable( &#x27;value1&#x27; );
     *   self.arg2 = &#x27;value2&#x27;;
     * }
     *
     * @param observableArray item. Where we want to add new data
     * @param mixed vhandler. Name of function or function which inits new data
     * @param object view_model. The current view_model object
     * @param object event.
     * @author peshkov@UD
     */
    self.add_data = function( item, vhanlder, view_model, event ) {
      if( typeof vhanlder == &#x27;function&#x27; ) {
        item.push( new vhanlder );
      } else if( typeof view_model[ vhanlder ] === &#x27;function&#x27; ) {
        item.push( new view_model[ vhanlder ]() );
      }
      try { self._args.actions.add_data( self, event, item, vhanlder ) }
      catch( e ) { self._args.callback( e, view_model ); }
    };

    /**
     * Adds message (success/warning/error)
     *
     * @author peshkov@UD
     */
    self.alert = function( message, type ) {
      var c = &#x27;alert-success&#x27;;
      if( typeof type !== &#x27;undefined&#x27; ) {
        switch( type ) {
          case &#x27;error&#x27;:
            c = &#x27;alert-error&#x27;;
            break;
          case &#x27;warning&#x27;:
            c = &#x27;&#x27;;
            break;
        }
      }
      var html = &#x27;&lt;div class=&quot;container alert fade in &#x27; + c + &#x27;&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot;&gt;&amp;times;&lt;/button&gt;&#x27; + message + &#x27;&lt;/div&gt;&#x27;;
      self.container.prepend( html );
    };

    /**
     * Removes data from array.
     *
     * Example of usage:
     * data-bind=&quot;click: $root.remove_data.bind( $data, $root.some_array )&quot;
     *
     * @param observableArray item. Where we want to remove data
     * @param mixed data. Data which should be removed from array.
     * @param object event.
     * @author peshkov@UD
     */
    self.remove_data = function( item, data, event ) {

      if( confirm( self.l10n.remove_confirmation ) ) {
        item.remove( data );
      }

      try {
        self._args.actions.remove_data( self, event, item, data )
      } catch( e ) { self._args.callback( e, self ); }
    };

    /**
     * Wrapper for ko.applyBindings()
     *
     * Calls before ko.applyBindings() - self.pre_apply()
     * Calls after ko.applyBindings()  - init()
     *
     * @TODO: NEED TO IMPLEMENT ASYNC HERE TO HAVE ABILITY TO LOAD ALL DATA FROM SOCKET BEFORE APPLYBINDING. peshkov@UD
     * @param array args. Optional
     * @author peshkov@UD
     */
    self.apply = function( args ) {
      var self = this;

      var element = self.container.get( 0 );

      if( self._applied ) {
        return self._args.callback( null, self, element );
      }

      async.series({
        &#x27;pre_apply&#x27;: function( callback ){
          /* Special Handlers can be added here */
          try {
            self._args.actions.pre_apply( self, callback );
          } catch( error ) {
            callback( &#x27;Error occured on VM pre_apply event&#x27; );
          }
        },
        &#x27;apply_bindings&#x27;: function( callback ){
          ko.applyBindings( self, self.container.get( 0 ) );
          self._applied = true;
          callback( null, true );
        },
        &#x27;init&#x27;: function ( callback ) {
          self.container.removeClass( &#x27;ud_ui_loading&#x27; ).addClass( &#x27;ud_ui_applied&#x27; );
          /* Special Handlers can be added here */
          try {
            self._args.actions.init( self, callback );
          } catch( error ) {
            callback( &#x27;Error occured on VM init event&#x27; );
          }
        }
      },
      function(err, results) {
          self.update( typeof args !== &#x27;undefined&#x27; ? args : [] );
          return self._args.callback( null, self );
      });

      return null;

    };

    /**
     * It&#x27;s just a wrapper.
     * It should be called if view_model should be updated
     *
     * @param array args. Optional
     * @author peshkov@UD
     */
    self.update = function( args ) {
      var self = this;
      /* Special Handlers can be added here */
      try { self._args.actions.update( self, typeof args !== &#x27;undefined&#x27; ? args : [] ); } catch( error ) { self._args.callback( error, self ); }
    };

    /* Add view_model data which is not related to args from model. */
    var m = {};
    var args = {};

    if( typeof self._args.model === &#x27;object&#x27; ? self._args.model : {} ) {
      jQuery.each( self._args.model, function( i, e ) {
        if( typeof self._args[ i ] === &#x27;undefined&#x27; ) { m[ i ] = e; } else { args[ i ] = e; }
      });
    }

    /* Combine arguments */
    self._args = jQuery.extend( true, self._args, args );

    /* All additional methods and elements for the current model are added here */
    self = jQuery.extend( true, self, typeof self._args.args === &#x27;object&#x27; ? self._args.args : args, m );

  };

  /* Bind Knockout */
  return new vm( args, container );

});


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
