<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scripts/src/jquery.ud.super-search.js - usabilitydynamics/lib-utility</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="usabilitydynamics/lib-utility"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/event.html">event</a></li>
            
                <li><a href="../modules/ud.html">ud</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scripts/src/jquery.ud.super-search.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/* =========================================================
 * jquery.ud.super_search.js v1.0.1
 * http://usabilitydynamics.com
 * =========================================================
 * Copyright 2012 Usability Dynamics, Inc.
 *
 * Validation: http://www.jslint.com/
 *
 * Copyright (c) 2012 Usability Dynamics, Inc. ( usabilitydynamics.com )
 * ========================================================= */

(function( jQuery ){
  jQuery.fn.super_search = function( ss_settings ) {

    var element = this;
    var abandoned_timer;
    var ui= {};
    var ux = {};
    var typing_timer;
    var query = {
      current: &#x27;&#x27;,
      previous: &#x27;&#x27;
    };

    /* Add ss_eleemnt attribute to this element so it can be IDied later */
    this.attr(&#x27;ss_element&#x27;, &#x27;search_input&#x27;);

   /* Default Settings */
    var ss = jQuery.extend({
      action : &#x27;super_search&#x27;,
      ajax_url : ajaxurl,
      input_classes : {
        no_results: &#x27;ss_no_results&#x27;,
        processing: &#x27;ss_processing&#x27;,
        error: &#x27;ss_error&#x27;
      },
      response_classes: {
        response_wrapper: &#x27;ss_response_container&#x27;,
        show_scroll: &#x27;ss_show_scroll&#x27;,
        item_class: &#x27;&#x27;
      },
      append_to: jQuery( element ).parent(),
      search_trigger: false,
      search_result_gap : 200,
      limit : 5,
      timers: {
        abandonment: 1000,
        search_entry : 2000
      },
      async : false,
      debug : true,
      success : false,
      beforeSend : false,
      ui: {}
    }, ss_settings);

    /* Internal logging function */

    if( typeof ss.log !== &#x27;function&#x27; ) {
      ss.log = function( something, type ) {

        if(!ss.debug) {
          return;
        }

        console.log(something);

      };
    }

    /* Do some QC early on - make sure append to element exist */
    if(!jQuery(ss.append_to).length) {
      ss.log(&#x27;The (&#x27; + ss.append_to + &#x27;) element does not exist.&#x27;, &#x27;warning&#x27;);
    }

    if( ss.search_trigger &amp;&amp; typeof ss.search_trigger === &#x27;object&#x27; ) {
      jQuery( ss.search_trigger ).click( function() {
      
        /* If current search is same as old, we do nothing */
        if(query.current == query.previous) {
          return;
        }
      
        jQuery.fn.super_search.do_search();
        
      });
    }

    this.keyup(function() {

      query.current = element.val();

      /* If no query, we stop scheduld search, if it scheduled */
      if(typing_timer &amp;&amp; !query.current) {
        clearTimeout(typing_timer);
        return;
      }

      /* If current search is same as old, we do nothing */
      if(query.current == query.previous) {
        return;
      }

      /* Clear timer because something was changed, and reset */
      if(typing_timer) {
        clearTimeout(typing_timer);
      }

      /* All is good, schedule search to happen in few seconds */
      typing_timer = setTimeout(jQuery.fn.super_search.do_search, ss.timers.search_entry);

    });

    /* Watch for when user enteres input area */
    this.focus(function() {
      jQuery.fn.super_search.ux_change();
    });

    /* Watch for when user leaves input area */
    this.blur(function() {
      jQuery.fn.super_search.ux_change();
    });


    /**
     * Search function, fired when user is done typing
     *
     * @todo Need error handling.
     * @todo Before send should probably accept data returned from callback function to manipulate what happens.
     */
    jQuery.fn.super_search.do_search = function() {
      ss.log(&#x27;do_search()&#x27;);

      //** Update to latest value */
      query.current = element.val();

      /* Build ajax post array */
      var post_data = {
          action: ss.action,
          limit: ss.limit,
          query: query.current
      }

      /* Build object for callback functions */
      cb_data = {
        post_data: post_data,
        settings: ss
      }

      /* Remove all status-related classes */
      jQuery.each(ss.input_classes, function(slug, css_class) {
        jQuery(element).removeClass(css_class);
      });

      jQuery(element).addClass(ss.input_classes.processing);

      jQuery.ajax({
        url: ss.ajax_url,
        async: ss.async,
        data: post_data,
        beforeSend: function(jqXHR, settings) {
          ss.log(&#x27;do_search.beforeSend() - have callback, executing&#x27;);

          /* Load current settings into CB data */
          cb_data.settings = settings;

          if(typeof ss.beforeSend == &#x27;function&#x27;){
            if(ss.beforeSend.call(this, cb_data)) {
              return;
            }
          }

        },
        complete: function(jqXHR, textStatus) {
          ss.log(&#x27;do_search.complete( jqXHR, &#x27; + textStatus + &#x27; )&#x27;);

          /* Clear out processing class, regardless of success */
          jQuery(element).removeClass(ss.input_classes.processing);

          ss.log(&#x27;Ajax response received.&#x27;);

        },
        success: function(data, textStatus, jqXHR) {
          ss.log(&#x27;do_search.success()&#x27;);

          if(typeof ss.success == &#x27;function&#x27;) {
            ss.log(&#x27;do_search.success() - have callback, executing&#x27;);
            if(ss.success.call(data, textStatus, jqXHR)) {
              return;
            }
          }

          /* Update &quot;Last Searched&quot; query */
          query.previous = query.current;

          //** Delete existing results, regardless of result to avoid confusion. */
          jQuery.fn.super_search.remove_rendered_results();

          if(data.results) {
            ss.last_results = data.results;
            jQuery.fn.super_search.render_results(data.results)
          } else {
            jQuery(element).addClass(ss.input_classes.no_results);
          }

          if(data.other) {
            ss.log(&quot;Search Debug Data:&quot; . data.debug_response);
          }

        },
        error: function(jqXHR, textStatus, errorThrown) {
          ss.log(&#x27;do_search.error()&#x27;);
          jQuery(element).addClass(ss.input_classes.error);

        },
        dataType: &quot;json&quot;
      });

    }


    /**
     * Remove search results.
     *
     */
    jQuery.fn.super_search.remove_rendered_results = function() {
      ss.log(&#x27;remove_rendered_results()&#x27;);

      if(ss.rendered_element &amp;&amp; ss.rendered_element.length) {
        jQuery(ss.rendered_element).fadeOut(300, function() {
          /* jQuery(this).remove();*/
        });
      }

      jQuery.fn.super_search.update_dom_triggers();

    }


    /**
     * Monitors visual changes to the DOM
     *
     */
    jQuery.fn.super_search.update_dom_triggers = function() {
      ss.log(&#x27;update_dom_triggers()&#x27;);

      /* Remove to avoid multiple triggers */
      jQuery(ss.rendered_element).off(&#x27;mouseenter&#x27;);
      jQuery(ss.rendered_element).off(&#x27;mouseleave&#x27;);

      /* Create event to hide rearch result if user&#x27;s mouse leaves the area, and update UX status */
      jQuery(ss.rendered_element).mouseenter(function() {
        ux.results_over = true;
        jQuery.fn.super_search.ux_change();
      }).mouseleave(function() {
        ux.results_over = false;
        jQuery.fn.super_search.ux_change();
      });

    }

    /**
     * Monitors user interactions with the interface, and updates any trigger events.
     *
     * Called on various events such as user working with input box, or leaving the input box
     *
     */
    jQuery.fn.super_search.ux_change = function() {
      ss.log(&#x27;ux_change()&#x27;);

      /* Check if user is focused on input element */
      if(jQuery(element).is(&quot;:focus&quot;)) {
        ux.input_focus = true;

        /* If search box is clicked, the query has not changed, and search result exists, we show them again */
        if(query.current == query.previous &amp;&amp; ss.rendered_element) {
          ss.rendered_element.show();
        }

      } else {
        ux.input_focus = false;
      }

      /* If user is not focused on input, and HAS moused over results, and left, we started a timer to hide the results */
      if(ss.rendered_element &amp;&amp; !ux.input_focus &amp;&amp; ux.results_over === false) {
        abandoned_timer = setTimeout(jQuery.fn.super_search.remove_rendered_results, ss.timers.abandonment);
      } else if(abandoned_timer) {
        clearTimeout(abandoned_timer);
      }

    }


    /**
     * Render search results from query
     *
     */
    jQuery.fn.super_search.render_results = function(results) {
      ss.log(&#x27;render_results()&#x27;);

      /* Account for zero based keys */
      var total_results = (results.length - 1);

      html = [];

      html.push( ss.ui.response_container = &#x27;&lt;ul ss_element=&quot;response_container&quot; class=&quot;ss_element &#x27; + ss.response_classes.response_wrapper + &#x27;&quot;&gt;&#x27; );

      console.log(ss.ui.response_container);

      jQuery.each(results, function(i, data) {

        var classes = [];

        if(ss.response_classes.item_class) {
          classes.push(ss.response_classes.item_class);
        }

        if(data.item_class) {
          classes.push(data.item_class);
        }

        if(i == total_results) {
          classes.push(&#x27;last_item&#x27;);
        }

        html.push(&#x27;&lt;li ss_element=&quot;single_item&quot; class=&quot;ss_element &#x27; + classes.join(&#x27; &#x27;) + &#x27;&quot;&gt;&#x27;);

        if(data.url) {
          html.push(&#x27;&lt;a href=&quot;&#x27; + data.url + &#x27;&quot;&gt;&#x27;);
        }

        html.push(data.title);

        if(data.url) {
          html.push(&#x27;&lt;/a&gt;&#x27;);
        }


        html.push(&#x27;&lt;/li&gt;&#x27;);
      });

      html.push(&#x27;&lt;/ul&gt;&#x27;);

      ss.rendered_element = jQuery(html.join(&#x27;&#x27;));

      jQuery(ss.append_to).append(ss.rendered_element);

      ui.window_height = jQuery(window).height();
      ui.rendered_element = jQuery(ss.rendered_element).height();

      if((ui.rendered_element + ss.search_result_gap) &gt; ui.window_height) {
        jQuery(ss.rendered_element).css(&#x27;max-height&#x27;, (ui.window_height - ss.search_result_gap) + &#x27;px&#x27;);
        jQuery(ss.rendered_element).addClass(ss.response_classes.show_scroll);
        ui.rendered_element = jQuery(ss.rendered_element).height();
      }

      jQuery.fn.super_search.update_dom_triggers();

    }


  };
})( jQuery );

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
