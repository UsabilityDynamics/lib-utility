<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scripts/src/udx.utility.activity.js - usabilitydynamics/lib-utility</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="usabilitydynamics/lib-utility"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/event.html">event</a></li>
            
                <li><a href="../modules/ud.html">ud</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scripts/src/udx.utility.activity.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * UsabilityDynamics Utility - Activity
 *
 * Handles pocess running.
 *
 * @example
 *
 *    var Activity = require( &#x27;udx.utility.activity&#x27; );
 *
 *    Activity.create({
 *      ajax: &#x27;admin-ajax.php?action=some-task&#x27;,
 *      args: {
 *        id: &#x27;some-task&#x27;,
 *      },
 *      interval: 100,
 *      onError: function() {},
 *      onComplete: function() {}
 *    });
 *
 * @version 0.1.0
 */
define( &#x27;udx.utility.activity&#x27;, [ &#x27;udx.utility&#x27;, &#x27;async&#x27;, &#x27;jquery&#x27; ], function() {
  console.debug( &#x27;udx.utility.activity&#x27;, &#x27;loaded&#x27; );

  // Modules.
  var Auto      = require( &#x27;async&#x27; ).auto;
  var Series    = require( &#x27;async&#x27; ).series;
  var Utility   = require( &#x27;udx.utility&#x27; );

  /**
   * Activity Instance
   *
   * @param args              {Object}
   * @param args.id           {String} ID of activity.
   * @param args.activity     {String} Name of activity type.
   * @param args.ajax         {String} URL of AJAX handler.
   * @param args.args         {Object} Extra arguments to add to request.
   * @param args.poll         {Number} Update poll interval.
   * @param args.timeout      {Number}
   * @param args.protocol     {String}
   * @param args.format       {String}
   * @param args.headers      {Object}
   * @param args.onStart      {Function}
   * @param args.onCreate     {Function}
   * @param args.onPoll       {Function}
   * @param args.onComplete   {Function}
   * @param args.onError      {Function}
   * @param args.onTimeout    {Function}
   *
   * @returns {Activity}
   * @constructor
   */
  function Activity( args ) {
    console.debug( &#x27;udx.utility.activity&#x27;, &#x27;new Activity&#x27; );

    // Configure Settings.
    this.settings = Utility.defaults( args, {
      ajax: null,
      id: null,
      activity: &#x27;&#x27;,
      args: {},
      poll: 15000,
      timeout: 5000,
      protocol: &#x27;ajax&#x27;,
      format: &#x27;json&#x27;,
      headers: {},
      onStart: function onStart( error, data ) {},
      onCreate: function onCreate( error, data ) {},
      onPoll: function onPoll( error, data ) {},
      onComplete: function onComplete( error, data ) {},
      onError: function onError( error, data ) {},
      onTimeout: function onTimeout( error, data ) {}
    });

    // Create Timers Container.
    this._timers = {
      create: new Date().getTime(),
      poll: undefined
    };

    // @chainable
    return Activity.instances[ this.settings.id ] = this;

  }

  /**
   * Instance Properties.
   *
   */
  Object.defineProperties( Activity.prototype, {
    create: {
      /**
       * Create Activity.
       *
       */
      value: function createActivity() {
        console.debug( &#x27;udx.utility.activity&#x27;, &#x27;createActivity&#x27; );

        var _context = this;

        jQuery.ajax({
          url: _context.settings.ajax,
          timeout: _context.settings.timeout,
          async: true,
          cache: false,
          type: &#x27;GET&#x27;,
          contentType: &#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;,
          dataType: _context.settings.format || &#x27;json&#x27;,
          headers: _context.settings.headers || {},
          data: Utility.extend({
            id: _context.settings.id,
            activity: _context.settings.type,
            event: &#x27;create&#x27;
          }, _context.settings.args ),
          error: function error( error ) {
            console.debug( &#x27;udx.utility.activity&#x27;, &#x27;create&#x27;, &#x27;::error&#x27;, error );

            _context.settings.onStart( new Error( &#x27;Activity Start Error: &#x27; + error ) );

          },
          complete: function complete( response, status ) {
            console.debug( &#x27;udx.utility.activity&#x27;, &#x27;create&#x27;, &#x27;::complete&#x27;, status );

            if( response.responseJSON ) {
              _context.settings.onCreate( null, response.responseJSON );
            }

            // Create Poll.
            _context._timers.poll = window.setInterval( _context.poll.bind( _context ), _context.settings.poll );

          }
        });

        // @chainable
        return this;

      },
      enumerable: true,
      configurable: true,
      writable: true
    },
    start: {
      /**
       * Start Activity.
       *
       */
      value: function startActivity() {
        console.debug( &#x27;udx.utility.activity&#x27;, &#x27;startActivity&#x27; );

        var _context = this;

        jQuery.ajax({
          url: _context.settings.ajax,
          timeout: _context.settings.timeout,
          async: true,
          cache: false,
          type: &#x27;GET&#x27;,
          contentType: &#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;,
          dataType: _context.settings.format || &#x27;json&#x27;,
          headers: _context.settings.headers || {},
          data: Utility.extend({
            id: _context.settings.id,
            activity: _context.settings.type,
            event: &#x27;start&#x27;
          }, _context.settings.args ),
          error: function error( error ) {
            console.debug( &#x27;udx.utility.activity&#x27;, &#x27;start&#x27;, &#x27;::error&#x27;, error );

            _context.settings.onStart( new Error( &#x27;Activity Start Error: &#x27; + error ) );

          },
          complete: function complete( response, status ) {
            console.debug( &#x27;udx.utility.activity&#x27;, &#x27;start&#x27;, &#x27;complete&#x27;, status );

            if( response.responseJSON ) {
              _context.settings.onStart( null, response.responseJSON );
            }

            // Create Poll.
            _context._timers.poll = window.setInterval( _context.poll.bind( _context ), _context.settings.poll );

          }
        });

        // @chainable
        return this;

      },
      enumerable: true,
      configurable: true,
      writable: true
    },
    poll: {
      /**
       * Poll Started Activity.
       *
       */
      value: function pollActivity() {
        // console.debug( &#x27;udx.utility.activity&#x27;, &#x27;pollActivity&#x27; );

        // Run Poll Callback.
        // this.settings.onPoll( error, data );

        // @chainable
        return this;

      },
      enumerable: true,
      configurable: true,
      writable: true
    },
    recover: {
      /**
       * Poll Started Activity.
       *
       */
      value: function recoverActivity() {
        console.debug( &#x27;udx.utility.activity&#x27;, &#x27;recoverActivity&#x27; );

        // @chainable
        return this;

      },
      enumerable: true,
      configurable: true,
      writable: true
    }
  });

  /**
   * Constructor Properties.
   *
   */
  Object.defineProperties( Activity, {
    create: {
      /**
       * Create Activity.
       *
       * @returns {Activity}
       */
      value: function create() {
        return new Activity( arguments[0] );
      },
      enumerable: true,
      configurable: true,
      writable: true
    },
    instances: {
      /**
       * Track Instances.
       *
       */
      value: {},
      enumerable: false,
      configurable: true,
      writable: true
    }
  });

  // Expose Activity.
  return Activity;

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
